<Controls:MetroWindow x:Class="OrdersGenerations.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:Controls="clr-namespace:MahApps.Metro.Controls;assembly=MahApps.Metro"
        xmlns:local="clr-namespace:OrdersGenerations"
        mc:Ignorable="d"
        DataContext="{Binding Source={StaticResource Locator}, Path=Main}"
        Title="MainWindow" Height="450" Width="800">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="0.25*" />
            <RowDefinition Height="0.05*" />
            <RowDefinition Height="0.7*" />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="0.75*" />
            <ColumnDefinition Width="0.25*"/>
        </Grid.ColumnDefinitions>
        <StackPanel>
            <DockPanel>
                <Label>Накладна №</Label>
                <TextBlock Text="{Binding CurrentOrder.ID}" />
            </DockPanel>
            <DockPanel>
                <Label>Клієнт</Label>
                <ListView ItemsSource="{Binding Clients}" SelectedItem="{Binding SelectedClient}">
                    <ListView.View>
                        <GridView>
                            <GridViewColumn DisplayMemberBinding="{Binding Path=FirstName}" />
                            <GridViewColumn DisplayMemberBinding="{Binding Path=SurnameName}" />
                            <GridViewColumn DisplayMemberBinding="{Binding Path=LastName}" />
                            <GridViewColumn DisplayMemberBinding="{Binding Path=Address}" />
                            <GridViewColumn DisplayMemberBinding="{Binding Path=Description}" />
                        </GridView>
                    </ListView.View>
                </ListView>
            </DockPanel>
            <DockPanel>
                <Label>Дата створення</Label>
                <TextBlock Text="{Binding CurrentOrder.CreatedDate}" />
            </DockPanel>
        </StackPanel>
        <StackPanel Grid.Column="1" Grid.Row="0">
            <DataGrid ItemsSource="{Binding Orders}" AutoGenerateColumns="False" SelectedItem="{Binding CurrentOrder}">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Номер" Binding="{Binding Path=ID}" Width="0.5*" />
                    <DataGridTextColumn Header="Дата" Binding="{Binding Path=CreatedDate}" Width="0.5*" />
                </DataGrid.Columns>
            </DataGrid>
        </StackPanel>
        <StackPanel Grid.Column="0" Grid.Row="2">
            <DockPanel HorizontalAlignment="Left">
                <TextBox Width="250" />
                <Button Content="Нова накладна"
                        Command="{Binding CreateOrderCommand}"/>
                <Button Content="Зберегти накладну" 
                         Command="{Binding SaveOrderCommand}" IsEnabled="{Binding IsSavingAllowed}"/>
                <Button Content="Копіювати накладну" 
                         Command="{Binding CopyOrderCommand}"/>
                <Button Content="Попередній перегляд"
                        Command="{Binding ReportPreviewCommand}" />
            </DockPanel>
            <DataGrid CanUserAddRows="False" IsHitTestVisible="{Binding IsSavingAllowed}" ItemsSource="{Binding SelectedPositions, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" AutoGenerateColumns="False">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Штрих-код" Binding="{Binding Path=Product.Barcode}" />
                    <DataGridTextColumn Header="Товар" Binding="{Binding Path=Product.Caption}" />
                    <DataGridTextColumn Header="Кількість" Binding="{Binding Path=ProductQuantity}" />
                    <DataGridTemplateColumn>
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <ComboBox SelectedItem="{Binding Dimension, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                          SelectedValue="ID"
                                          DisplayMemberPath="Caption" 
                                          ItemsSource="{Binding Path=DataContext.Dimensions, Mode=TwoWay, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type DataGrid}}}" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>

                    </DataGridTemplateColumn>
                    <DataGridTextColumn Header="Ціна" Binding="{Binding Path=Product.Price}" />
                    <DataGridTextColumn Header="Всього" Binding="{Binding Path=TotalPrice}" />
                    <DataGridTemplateColumn>
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Button Content="-"
                                        Command="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type DataGrid}}, Path=DataContext.RemovePositionCommand}"
                                        CommandParameter="{Binding}" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </StackPanel>
        <StackPanel Grid.Column="1" Grid.Row="2">
            <TextBox />
            <DataGrid  ItemsSource="{Binding Products}" AutoGenerateColumns="False">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Код" Binding="{Binding Path=Barcode}" Width="0.3*" />
                    <DataGridTextColumn Header="Назва" Binding="{Binding Path=Caption}" Width="0.3*" />
                    <DataGridTextColumn Header="Ціна" Binding="{Binding Path=Price}" Width="0.3*" />
                    <DataGridTemplateColumn Header="Дія">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Button Content="+"
                                        Command="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type DataGrid}}, Path=DataContext.AddNewPositionCommand}"
                                        CommandParameter="{Binding}" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </StackPanel>

    </Grid>
</Controls:MetroWindow>
